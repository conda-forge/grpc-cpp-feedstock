From 30f3d14ac2adffd8e4fca9844207ed87cc1e60c4 Mon Sep 17 00:00:00 2001
From: Isuru Fernando <isuruf@gmail.com>
Date: Sat, 22 Oct 2022 02:21:08 -0500
Subject: [PATCH 3/3] fix support_enabled for windows

---
 src/core/lib/gprpp/fork.cc | 12 ++++++++++++
 src/core/lib/gprpp/fork.h  | 12 ++----------
 2 files changed, 14 insertions(+), 10 deletions(-)

diff --git a/src/core/lib/gprpp/fork.cc b/src/core/lib/gprpp/fork.cc
index 31fcc77..2ea16e0 100644
--- a/src/core/lib/gprpp/fork.cc
+++ b/src/core/lib/gprpp/fork.cc
@@ -185,6 +185,18 @@ bool Fork::Enabled() {
   return support_enabled_.load(std::memory_order_relaxed);
 }
 
+void Fork::IncExecCtxCount() {
+  if (GPR_UNLIKELY(support_enabled_.load(std::memory_order_relaxed))) {
+    DoIncExecCtxCount();
+  }
+}
+
+void Fork::DecExecCtxCount() {
+  if (GPR_UNLIKELY(support_enabled_.load(std::memory_order_relaxed))) {
+    DoDecExecCtxCount();
+  }
+}
+
 // Testing Only
 void Fork::Enable(bool enable) {
   override_enabled_ = true;
diff --git a/src/core/lib/gprpp/fork.h b/src/core/lib/gprpp/fork.h
index d6ef161..f739d70 100644
--- a/src/core/lib/gprpp/fork.h
+++ b/src/core/lib/gprpp/fork.h
@@ -47,18 +47,10 @@ class Fork {
 
   // Increment the count of active ExecCtxs.
   // Will block until a pending fork is complete if one is in progress.
-  static void IncExecCtxCount() {
-    if (GPR_UNLIKELY(support_enabled_.load(std::memory_order_relaxed))) {
-      DoIncExecCtxCount();
-    }
-  }
+  static void IncExecCtxCount();
 
   // Decrement the count of active ExecCtxs
-  static void DecExecCtxCount() {
-    if (GPR_UNLIKELY(support_enabled_.load(std::memory_order_relaxed))) {
-      DoDecExecCtxCount();
-    }
-  }
+  static void DecExecCtxCount();
 
   // Provide a function that will be invoked in the child's postfork handler to
   // reset the polling engine's internal state.
-- 
2.37.3

