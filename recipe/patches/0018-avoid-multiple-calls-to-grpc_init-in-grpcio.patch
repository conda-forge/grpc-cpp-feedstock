From 919264aff11f5c641090e3c9a40de85b2c020bb1 Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Sat, 21 Feb 2026 23:08:01 +1100
Subject: [PATCH 18/18] avoid multiple calls to `grpc_init` in grpcio

---
 src/python/grpcio/grpc/_cython/_cygrpc/fork_posix.pyx.pxi   | 3 ++-
 src/python/grpcio/grpc/_cython/_cygrpc/fork_windows.pyx.pxi | 3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/python/grpcio/grpc/_cython/_cygrpc/fork_posix.pyx.pxi b/src/python/grpcio/grpc/_cython/_cygrpc/fork_posix.pyx.pxi
index afe5fa1d1b..8c4284aeb5 100644
--- a/src/python/grpcio/grpc/_cython/_cygrpc/fork_posix.pyx.pxi
+++ b/src/python/grpcio/grpc/_cython/_cygrpc/fork_posix.pyx.pxi
@@ -95,7 +95,8 @@ cdef void __postfork_child() noexcept nogil:
 
 
 def fork_handlers_and_grpc_init():
-    grpc_init()
+    if not grpc_is_initialized():
+        grpc_init()
     if _GRPC_ENABLE_FORK_SUPPORT:
         with _fork_state.fork_handler_registered_lock:
             if not _fork_state.fork_handler_registered:
diff --git a/src/python/grpcio/grpc/_cython/_cygrpc/fork_windows.pyx.pxi b/src/python/grpcio/grpc/_cython/_cygrpc/fork_windows.pyx.pxi
index 67aaf4d033..82e80555fc 100644
--- a/src/python/grpcio/grpc/_cython/_cygrpc/fork_windows.pyx.pxi
+++ b/src/python/grpcio/grpc/_cython/_cygrpc/fork_windows.pyx.pxi
@@ -16,7 +16,8 @@
 # No-op implementations for Windows.
 
 def fork_handlers_and_grpc_init():
-    grpc_init()
+    if not grpc_is_initialized():
+        grpc_init()
 
 
 class ForkManagedThread(object):
